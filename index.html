<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>Tyrannus — 표준킹제임스성경</title>

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600&family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400;1,600&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<link rel="stylesheet" href="css/fonts.css?v=13">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<!-- App CSS (모듈화) -->
<link rel="stylesheet" href="css/variables.css?v=15">
<link rel="stylesheet" href="css/layout.css?v=15">
<link rel="stylesheet" href="css/icon-rail.css?v=16">
<link rel="stylesheet" href="css/side-panel.css?v=15">
<link rel="stylesheet" href="css/topbar.css?v=17">
<link rel="stylesheet" href="css/bible.css?v=19">
<link rel="stylesheet" href="css/notes.css?v=18">
<link rel="stylesheet" href="css/commentary.css?v=15">
<link rel="stylesheet" href="css/search.css?v=15">
<link rel="stylesheet" href="css/ui.css?v=15">
<link rel="stylesheet" href="css/nav-picker.css?v=15">
<link rel="stylesheet" href="css/book-grid.css?v=15">
<link rel="stylesheet" href="css/bookmark.css?v=15">
<link rel="stylesheet" href="css/word-study.css?v=15">
<link rel="stylesheet" href="css/xref-inline.css?v=15">
<link rel="stylesheet" href="css/passage-guide.css?v=15">
<link rel="stylesheet" href="css/visual-filter.css?v=15">
<link rel="stylesheet" href="css/reading-plan.css?v=15">
<link rel="stylesheet" href="css/adv-search.css?v=15">
<link rel="stylesheet" href="css/dict.css?v=17">
<link rel="stylesheet" href="css/sync.css?v=15">
<link rel="stylesheet" href="css/settings-panel.css?v=15">

<!-- Firebase (ES module — 병렬 로드) -->
<script type="module" src="js/firebase.js"></script>
</head>

<body>

<!-- 숨겨진 호환용 요소들 -->
<select id="bookSel" style="display:none" onchange="onBookChange()"></select>
<select id="chSel" style="display:none" onchange="onChChange()"></select>
<button id="navPickerBtn" class="nav-picker-btn" style="display:none" onclick="toggleNavPicker()">
  <span id="navPickerLabel">창세기 1장</span>
  <i class="fa fa-chevron-down nav-picker-arrow"></i>
</button>
<div id="navPickerPopup" class="nav-picker-popup"></div>
<input type="hidden" id="qsInput">

<!-- ══ MAIN ════════════════════════════════════ -->
<div id="main">

  <!-- 사이드바 토글 (레일 밖, 항상 접근 가능) -->
  <button class="rail-toggle-btn" id="railToggleBtn" onclick="_toggleIconRail()" ontouchend="_toggleIconRail();event.preventDefault();" title="사이드바 열기/닫기">
    <svg class="rail-ico rail-ico-open" width="18" height="18" viewBox="0 0 20 20" fill="none" style="pointer-events:none"><rect x="1.5" y="1.5" width="17" height="17" rx="3" stroke="currentColor" stroke-width="1.6"/><rect x="1.5" y="1.5" width="6" height="17" rx="3" fill="currentColor" opacity=".4"/><line x1="9.5" y1="4" x2="9.5" y2="16" stroke="currentColor" stroke-width="1.2" opacity=".35"/></svg>
    <svg class="rail-ico rail-ico-closed" width="18" height="18" viewBox="0 0 20 20" fill="none" style="pointer-events:none"><rect x="1.5" y="1.5" width="17" height="17" rx="3" stroke="currentColor" stroke-width="1.6"/><rect x="1.5" y="1.5" width="6" height="17" rx="3" fill="currentColor" opacity=".4"/></svg>
  </button>

  <!-- LEFT: Slack 스타일 아이콘 레일 -->
  <div id="iconRail">
    <div class="rail-top">
      <button class="rail-icon" data-rail="bible" onclick="toggleRail('bible')" title="성경 목록">
        <i class="fa fa-book-bible"></i><span class="rail-label">성경</span>
      </button>
      <button class="rail-icon" data-rail="notes" onclick="toggleNotePanel()" title="노트">
        <i class="fa fa-pen"></i><span class="rail-label">노트</span>
      </button>
      <button class="rail-icon" data-rail="search" onclick="toggleRail('search')" title="검색">
        <i class="fa fa-search"></i><span class="rail-label">검색</span>
      </button>
      <button class="rail-icon" data-rail="dictionary" onclick="toggleDictPanel()" title="사전">
        <i class="fas fa-spell-check"></i><span class="rail-label">사전</span>
      </button>
      <button class="rail-icon" data-rail="bookmark" onclick="toggleRail('bookmark')" title="북마크">
        <i class="fa fa-bookmark"></i><span class="rail-label">북마크</span>
      </button>
      <button class="rail-icon" data-rail="reading" onclick="toggleRail('reading')" title="읽기 계획">
        <i class="fa fa-calendar-check"></i><span class="rail-label">읽기</span>
      </button>
    </div>
    <div class="rail-bottom">
      <!-- 사용자 영역 (아바타 + 로그아웃만) -->
      <div id="railUser">
        <button id="loginBtn" class="rail-icon" onclick="signInWithGoogle()" title="로그인">
          <i class="fa fa-sign-in-alt"></i>
        </button>
        <div id="userBar" class="rail-user-info" style="display:none">
          <img id="userAvatar" class="rail-avatar" src="">
          <button class="rail-logout" onclick="signOutUser()" title="로그아웃"><i class="fa fa-sign-out-alt"></i></button>
        </div>
      </div>
      <button class="rail-icon" data-rail="settings" onclick="toggleRail('settings')" title="설정">
        <i class="fa fa-cog"></i><span class="rail-label">설정</span>
      </button>
    </div>
  </div>

  <!-- LEFT: 확장 사이드패널 -->
  <div id="sidePanel">
    <!-- 성경 목록 -->
    <div class="sp-section" id="sp-bible">
      <div class="sp-head"><i class="fa fa-book-bible"></i> 성경 목록<button class="sp-pin-btn" id="spPinBtn" onclick="_spTogglePin()" title="고정"><i class="fa fa-thumbtack"></i></button></div>
      <div class="sp-body" id="bookList"></div>
    </div>
    <!-- 검색 (통합: 기본 + 고급) -->
    <div class="sp-section" id="sp-search">
      <div class="sp-head"><i class="fa fa-search"></i> 검색</div>
      <div class="sp-body" id="spSearchBody" style="display:flex;flex-direction:column;overflow:hidden"></div>
    </div>
    <!-- 북마크 -->
    <div class="sp-section" id="sp-bookmark">
      <div class="sp-head"><i class="fa fa-bookmark"></i> 북마크</div>
      <div class="sp-body" id="spBookmarkList"></div>
    </div>
    <!-- 읽기 계획 -->
    <div class="sp-section" id="sp-reading">
      <div class="sp-head"><i class="fa fa-calendar-check"></i> 읽기 계획</div>
      <div class="sp-body" id="spReadingContent">
        <div style="padding:20px;text-align:center;color:var(--text3);font-size:12px"><i class="fa fa-calendar-check" style="font-size:24px;margin-bottom:8px;display:block;opacity:.4"></i>준비 중입니다</div>
      </div>
    </div>
    <!-- 설정 패널 -->
    <div class="sp-section" id="sp-settings">
      <div class="sp-head"><i class="fa fa-cog"></i> 설정</div>
      <div class="sp-body" id="spSettingsBody"></div>
    </div>
  </div>

  <!-- 레거시 요소 (숨김) -->
  <div id="bookNav" style="display:none"><div id="bookNavTab"></div></div>
  <div id="bookNavOverlay" style="display:none"></div>

  <!-- CENTER: Bible Text -->
  <div id="biblePane">
    <div id="bibleTabBar">
      <div id="bibleTabList"></div>
      <button id="bibleTabAdd" onclick="addBibleTab()" title="새 탭"><i class="fa fa-plus"></i></button>
    </div>
    <!-- 뷰 바 -->
    <div id="bibleViewBar">
      <div class="vb-left">
        <button class="vb-sel" id="vbBookSel" onclick="openBookDrop()"><span id="vbBookLabel">창세기</span> <i class="fa fa-caret-down vb-caret"></i></button>
        <button class="vb-sel vb-ch-sel" id="vbChSel" onclick="openChDrop()"><span id="vbChNum">1</span>장 <i class="fa fa-caret-down vb-caret"></i></button>
        <button class="vb-arrow" onclick="prevCh()" title="이전 장"><i class="fa fa-chevron-left"></i></button>
        <button class="vb-arrow" onclick="nextCh()" title="다음 장"><i class="fa fa-chevron-right"></i></button>
      </div>
      <div class="vb-right">
        <button class="vb-btn vb-on" id="vbKorean" onclick="toggleLang('kr')" title="한글 본문">한</button>
        <button class="vb-btn" id="vbEnglish" onclick="toggleLang('en')" title="영어 본문">영</button>
        <span class="vb-sep"></span>
        <button class="vb-btn" id="vbRed" onclick="toggleRedLetter()" title="예수님 말씀"><i class="fa fa-cross"></i></button>
        <button class="vb-btn" id="vbStrong" onclick="toggleStrongCodes()" title="원어 코드"><i class="fa fa-code"></i></button>
        <button class="vb-btn vb-on" id="vbHL" onclick="toggleHighlight()" title="형광펜 표시"><i class="fa fa-highlighter"></i></button>
        <span class="vb-sep"></span>
        <span class="vb-info" id="vbVerseCount"></span>
      </div>
    </div>
    <!-- 책 드롭다운 -->
    <div id="bookDropdown" class="cp-drop" style="display:none"></div>
    <!-- 장 드롭다운 -->
    <div id="chDropdown" class="cp-drop cp-drop-ch" style="display:none"></div>
    <div id="bibleScroll">
      <div class="ch-head">
        <h1 id="chTitle">창세기 1장</h1>
        <p id="chSub">Genesis</p>
      </div>
      <div id="vCont"></div>
      <div class="ch-nav">
        <button class="chnav" onclick="prevCh()"><i class="fa fa-chevron-left"></i> 이전 장</button>
        <span style="font-size:11px;color:var(--text3)" id="chNavLbl"></span>
        <button class="chnav" onclick="nextCh()">다음 장 <i class="fa fa-chevron-right"></i></button>
      </div>
    </div>
  </div>

  <!-- RIGHT: Panel (초기 비활성) -->
  <div id="rightPanel" class="rp-hide">
    <div class="rp-tabs" id="rpTabs">
      <div class="rp-subtabs" id="subtabs-notes">
        <button class="rp-ico-btn" onclick="toggleExplorer()" title="노트 목록"><i class="fa fa-folder-open"></i></button>
        <div class="rp-tab act" data-sub="notes" onclick="switchSub('notes')"><i class="fa fa-pen"></i> 노트</div>
        <div class="rp-tab" data-sub="commentary" onclick="switchSub('commentary')"><i class="fa fa-scroll"></i> 주석</div>
        <div class="rp-tab" data-sub="outline" onclick="switchSub('outline')"><i class="fa fa-sitemap"></i> 아웃라인</div>
        <button class="rp-ico-btn rp-close-btn" onclick="togglePanel('notes')" title="패널 닫기"><i class="fa fa-times"></i></button>
      </div>
      <div class="rp-subtabs" id="subtabs-dict" style="display:none">
        <div class="rp-tab act" data-sub="dict-strongs" onclick="switchSub('dict-strongs')"><i class="fa fa-language"></i> 스트롱</div>
        <div class="rp-tab" data-sub="dict-webster" onclick="switchSub('dict-webster')"><i class="fa fa-spell-check"></i> 웹스터</div>
        <div class="rp-tab" data-sub="dict-enko" onclick="switchSub('dict-enko')"><i class="fa fa-exchange-alt"></i> 영한</div>
        <div class="rp-tab" data-sub="dict-korean" onclick="switchSub('dict-korean')"><i class="fa fa-font"></i> 표준국어</div>
        <button class="rp-ico-btn rp-close-btn" onclick="togglePanel('dictionary')" title="패널 닫기"><i class="fa fa-times"></i></button>
      </div>
      <div class="rp-subtabs" id="subtabs-search" style="display:none">
        <div class="rp-tab act" data-sub="search" onclick="switchSub('search')"><i class="fa fa-search"></i> 검색설정</div>
      </div>
    </div>
    <div class="rp-body">

      <!-- NOTES TAB -->
      <div class="rp-sec act" id="sec-notes">
        <div id="notesLayout">
          <div id="explorerOverlay" onclick="closeExplorer()"></div>
          <div id="noteExplorer">
            <div class="exp-head">
              <span class="exp-title">Vault</span>
              <div class="exp-actions">
                <button class="exp-btn" title="새 노트" onclick="newNote()"><i class="fa fa-file-circle-plus"></i></button>
                <button class="exp-btn" title="새 폴더" onclick="newFolder()"><i class="fa fa-folder-plus"></i></button>
                <button class="exp-btn" title="모두 접기" onclick="_ftCollapseAll()"><i class="fa fa-compress-alt"></i></button>
                <button class="exp-btn" title="닫기" onclick="closeExplorer()"><i class="fa fa-times"></i></button>
              </div>
            </div>
            <div id="folderTree"></div>
          </div>
          <div id="noteEditor">
            <div class="rte-bar">
              <div class="rte-row">
                <select class="rte-sel" onchange="cmd('formatBlock',this.value);this.value=''">
                  <option value="">단락</option>
                  <option value="h1">H1</option>
                  <option value="h2">H2</option>
                  <option value="h3">H3</option>
                  <option value="p">본문</option>
                  <option value="blockquote">인용</option>
                </select>
                <select class="rte-sel rte-fontsize" title="글꼴 크기" onchange="setFontSize(this.value);this.value=''">
                  <option value="">크기</option>
                  <option value="10">10</option><option value="12">12</option><option value="14">14</option>
                  <option value="16">16</option><option value="18">18</option><option value="20">20</option>
                  <option value="24">24</option><option value="28">28</option><option value="32">32</option>
                </select>
                <div class="rte-sep"></div>
                <button class="rte-btn" title="굵게 (Ctrl+B)" onmousedown="event.preventDefault()" onclick="cmd('bold')"><b>B</b></button>
                <button class="rte-btn" title="기울임 (Ctrl+I)" onmousedown="event.preventDefault()" onclick="cmd('italic')"><i>I</i></button>
                <button class="rte-btn" title="밑줄 (Ctrl+U)" onmousedown="event.preventDefault()" onclick="cmd('underline')"><u>U</u></button>
                <button class="rte-btn" title="취소선" onmousedown="event.preventDefault()" onclick="cmd('strikeThrough')"><s>S</s></button>
                <div class="rte-sep"></div>
                <button class="rte-btn" title="텍스트 색상" onclick="openColorPalette(this,'fore')" onmousedown="event.preventDefault()"><i class="fa fa-font" style="color:var(--gold)"></i></button>
                <button class="rte-btn" title="배경 하이라이트" onclick="openColorPalette(this,'bg')" onmousedown="event.preventDefault()"><i class="fa fa-fill-drip"></i></button>
                <div class="rte-sep"></div>
                <button class="rte-btn" title="글머리 목록" onmousedown="event.preventDefault()" onclick="cmd('insertUnorderedList')"><i class="fa fa-list-ul"></i></button>
                <button class="rte-btn" title="번호 목록" onmousedown="event.preventDefault()" onclick="cmd('insertOrderedList')"><i class="fa fa-list-ol"></i></button>
                <div class="rte-sep"></div>
                <button class="rte-btn" title="왼쪽 정렬" onmousedown="event.preventDefault()" onclick="cmd('justifyLeft')"><i class="fa fa-align-left"></i></button>
                <button class="rte-btn" title="가운데 정렬" onmousedown="event.preventDefault()" onclick="cmd('justifyCenter')"><i class="fa fa-align-center"></i></button>
                <button class="rte-btn" title="오른쪽 정렬" onmousedown="event.preventDefault()" onclick="cmd('justifyRight')"><i class="fa fa-align-right"></i></button>
                <div class="rte-sep"></div>
                <button class="rte-btn" title="표 삽입" onclick="insertTable()"><i class="fa fa-table"></i></button>
                <button class="rte-btn" title="구분선" onmousedown="event.preventDefault()" onclick="cmd('insertHorizontalRule')"><i class="fa fa-minus"></i></button>
                <div class="rte-sep"></div>
                <button class="rte-btn" title="실행 취소" onmousedown="event.preventDefault()" onclick="cmd('undo')"><i class="fa fa-undo"></i></button>
                <button class="rte-btn" title="다시 실행" onmousedown="event.preventDefault()" onclick="cmd('redo')"><i class="fa fa-redo"></i></button>
                <div class="rte-sep"></div>
                <button class="rte-btn" title="들여쓰기" onmousedown="event.preventDefault()" onclick="cmd('indent')"><i class="fa fa-indent"></i></button>
                <button class="rte-btn" title="내어쓰기" onmousedown="event.preventDefault()" onclick="cmd('outdent')"><i class="fa fa-outdent"></i></button>
              </div>
              <div class="rte-row rte-row2">
                <span class="rte-row-label">삽입</span>
                <div class="rte-sep"></div>
                <button class="rte-btn rte-insert" onclick="openNoteLink()" title="노트 링크 삽입"><i class="fa fa-link"></i><span class="rte-lbl">노트</span></button>
                <button class="rte-btn rte-insert" onclick="openVersePick()" title="구절 링크 삽입"><i class="fa fa-book-open"></i><span class="rte-lbl">구절</span></button>
                <button class="rte-btn rte-insert" onclick="openUrlEmbed(this)" title="외부 링크 삽입"><i class="fa fa-globe"></i><span class="rte-lbl">링크</span></button>
                <button class="rte-btn rte-insert" onclick="openYoutubeEmbed(this)" title="유튜브 삽입"><i class="fab fa-youtube"></i><span class="rte-lbl">유튜브</span></button>
                <button class="rte-btn rte-insert" onclick="openFileAttach()" title="파일/이미지 첨부"><i class="fa fa-paperclip"></i><span class="rte-lbl">파일</span></button>
                <div class="rte-sep"></div>
                <button class="rte-btn" onmousedown="event.preventDefault()" onclick="insertCallout('info')" title="정보 박스"><i class="fa fa-info-circle" style="color:#4a9eff"></i></button>
                <button class="rte-btn" onmousedown="event.preventDefault()" onclick="insertCallout('warn')" title="경고 박스"><i class="fa fa-exclamation-triangle" style="color:#f0a500"></i></button>
                <button class="rte-btn" onmousedown="event.preventDefault()" onclick="insertCallout('pray')" title="아이디어/묵상 박스"><i class="fa fa-lightbulb" style="color:var(--gold)"></i></button>
                <div class="rte-sep"></div>
                <button class="rte-btn rte-insert" onmousedown="event.preventDefault()" onclick="insertCheckbox()" title="체크박스 삽입"><i class="fa fa-check-square"></i><span class="rte-lbl">체크</span></button>
                <button class="rte-btn rte-insert" onmousedown="event.preventDefault()" onclick="insertDateStamp()" title="날짜 삽입"><i class="fa fa-calendar-day"></i><span class="rte-lbl">날짜</span></button>
              </div>
            </div>
            <div id="noteContent" contenteditable="true" data-ph="제목을 입력하세요..."></div>
            <div class="backlink-panel" id="backlinkPanel" style="display:none">
              <div class="backlink-head" onclick="toggleBacklinks()">
                <i class="fa fa-link"></i>&nbsp;백링크&nbsp;<span id="backlinkCount" style="color:var(--gold)"></span>
                <i class="fa fa-chevron-down" id="blChevron" style="margin-left:auto;transition:transform .2s;font-size:9px"></i>
              </div>
              <div id="backlinkList"></div>
            </div>
            <div class="note-nav-bar" id="noteNavBar" style="display:none">
              <button class="nav-back-btn" id="backBtn" onclick="goBack()" title="이전 노트로 돌아가기" style="display:none">
                <i class="fa fa-arrow-left"></i>
              </button>
              <div class="nav-path" id="navPath"></div>
              <div id="nedBreadcrumb" class="ned-breadcrumb"></div>
            </div>
            <div class="note-footer">
              <span class="nfooter-label">🏷</span>
              <div class="tag-row" id="tagRow">
                <input class="tag-inp" id="tagInp" placeholder="태그..." onkeydown="addTag(event)">
              </div>
              <select id="noteFolderSel" style="display:none"></select>
            </div>
          </div>
        </div>
      </div>

      <!-- COMMENTARY SUB-TAB -->
      <div class="rp-sec" id="sec-commentary">
        <div class="comm-mode-bar">
          <button class="comm-mode-btn comm-mode-active" id="commModeVerse" onclick="setCommMode('verse')">
            <i class="fa fa-crosshairs"></i> 구절별
          </button>
          <button class="comm-mode-btn" id="commModeChapter" onclick="setCommMode('chapter')">
            <i class="fa fa-list"></i> 장별
          </button>
        </div>
        <div class="comm-body-wrap" id="commentaryContent">
          <div class="comm-hint"><i class="fa fa-scroll"></i>구절을 클릭하면<br>주석을 볼 수 있어요</div>
        </div>
      </div>

      <!-- OUTLINE SUB-TAB -->
      <div class="rp-sec" id="sec-outline">
        <div class="outline-wrap" id="outlineContent">
          <div class="outline-toolbar">
            <span style="font-size:10px;font-weight:700;color:var(--text3);letter-spacing:.5px"><i class="fa fa-sitemap" style="margin-right:4px"></i>노트 아웃라인</span>
            <div style="display:flex;gap:4px">
              <button class="outline-tb-btn" onclick="toggleOutlineExpand()" title="모두 펼치기/접기"><i class="fa fa-expand-arrows-alt"></i></button>
            </div>
          </div>
          <div id="outlineTree" style="overflow-y:auto;flex:1;padding:6px 0"></div>
        </div>
      </div>

      <!-- DICTIONARY TAB -->
      <div class="rp-sec" id="sec-dictionary">
        <div class="rp-sec act" id="sec-dict-strongs" style="display:flex">
          <div style="padding:8px 12px;border-bottom:1px solid var(--border);flex-shrink:0;display:flex;gap:6px;align-items:center">
            <input type="text" id="strongsSearchInput" placeholder="스트롱 번호 (H1, G3056) 또는 원어 검색..."
              style="flex:1;background:var(--bg3);border:1px solid var(--border);border-radius:5px;padding:6px 10px;font-size:12px;color:var(--text);outline:none;"
              onkeydown="if(event.key==='Enter')searchStrongs()">
            <button onclick="searchStrongs()" style="padding:6px 12px;border-radius:5px;font-size:11px;font-weight:700;background:var(--gold);color:var(--bg);border:none;cursor:pointer;flex-shrink:0"><i class="fa fa-search"></i></button>
          </div>
          <div class="comm-body-wrap" id="dictStrongs" style="overflow-y:auto;flex:1">
            <div class="comm-hint"><i class="fa fa-language"></i> Strong's Concordance<br>원어 코드를 검색하거나<br>구절의 원어 코드를 클릭하세요<br><br><span style="font-size:10px;color:var(--text3)">H = 히브리어 (구약) · G = 그리스어 (신약)</span></div>
          </div>
        </div>
        <div class="rp-sec" id="sec-dict-webster" style="display:none;flex-direction:column">
          <div style="padding:8px 12px;border-bottom:1px solid var(--border);flex-shrink:0;display:flex;gap:6px;align-items:center">
            <input type="text" id="websterSearchInput" placeholder="English word (e.g., grace, faith)..."
              style="flex:1;background:var(--bg3);border:1px solid var(--border);border-radius:5px;padding:6px 10px;font-size:12px;color:var(--text);outline:none;"
              onkeydown="if(event.key==='Enter')searchWebster()">
            <button onclick="searchWebster()" style="padding:6px 12px;border-radius:5px;font-size:11px;font-weight:700;background:var(--gold);color:var(--bg);border:none;cursor:pointer;flex-shrink:0"><i class="fa fa-search"></i></button>
          </div>
          <div class="comm-body-wrap" id="dictWebster" style="overflow-y:auto;flex:1">
            <div class="comm-hint"><i class="fa fa-spell-check"></i> English Dictionary<br>영어 단어의 정의를 검색하세요<br><br><span style="font-size:10px;color:var(--text3)">발음 · 품사 · 정의 · 예문 · 동의어</span></div>
          </div>
        </div>
        <div class="rp-sec" id="sec-dict-enko" style="display:none;flex-direction:column">
          <div style="padding:8px 12px;border-bottom:1px solid var(--border);flex-shrink:0;display:flex;gap:6px;align-items:center">
            <input type="text" id="enkoSearchInput" placeholder="영한 검색 (e.g., salvation, mercy)..."
              style="flex:1;background:var(--bg3);border:1px solid var(--border);border-radius:5px;padding:6px 10px;font-size:12px;color:var(--text);outline:none;"
              onkeydown="if(event.key==='Enter')searchEnko()">
            <button onclick="searchEnko()" style="padding:6px 12px;border-radius:5px;font-size:11px;font-weight:700;background:var(--gold);color:var(--bg);border:none;cursor:pointer;flex-shrink:0"><i class="fa fa-search"></i></button>
          </div>
          <div class="comm-body-wrap" id="dictEnko" style="overflow-y:auto;flex:1">
            <div class="comm-hint"><i class="fa fa-exchange-alt"></i> English-Korean Dictionary<br>영어 단어를 한국어와 함께 검색하세요<br><br><span style="font-size:10px;color:var(--text3)">영어 정의 + 한국어 번역</span></div>
          </div>
        </div>
        <div class="rp-sec" id="sec-dict-korean" style="display:none;flex-direction:column">
          <div style="padding:8px 12px;border-bottom:1px solid var(--border);flex-shrink:0;display:flex;gap:6px;align-items:center">
            <input type="text" id="koreanSearchInput" placeholder="국어사전 검색..."
              style="flex:1;background:var(--bg3);border:1px solid var(--border);border-radius:5px;padding:6px 10px;font-size:12px;color:var(--text);outline:none;"
              onkeydown="if(event.key==='Enter')searchKorean()">
            <button onclick="searchKorean()" style="padding:6px 12px;border-radius:5px;font-size:11px;font-weight:700;background:var(--gold);color:var(--bg);border:none;cursor:pointer;flex-shrink:0"><i class="fa fa-search"></i></button>
          </div>
          <iframe id="koreanFrame" src="https://stdict.korean.go.kr/main/main.do" style="flex:1;border:none;width:100%;min-height:0"></iframe>
        </div>
      </div>

      <!-- SEARCH TAB -->
      <div class="rp-sec" id="sec-search">
        <div class="search-wrap">
          <div class="sch-row">
            <input type="text" id="schInput" placeholder="단어 또는 구절 검색..." onkeydown="if(event.key==='Enter')doSearch()">
            <button onclick="doSearch()">검색</button>
          </div>
          <div class="sch-filters">
            <label style="font-size:10px;color:var(--text3);margin-right:8px;display:inline-flex;align-items:center;gap:4px;">
              <input type="checkbox" id="filter-all" onchange="toggleAllFilters(this)" style="cursor:pointer"> 전체
            </label>
            <label style="font-size:10px;color:var(--text2);margin-right:8px;display:inline-flex;align-items:center;gap:4px;">
              <input type="checkbox" class="search-filter" data-f="OT" onchange="updateSearchFilters()" style="cursor:pointer" checked> 구약
            </label>
            <label style="font-size:10px;color:var(--text2);margin-right:8px;display:inline-flex;align-items:center;gap:4px;">
              <input type="checkbox" class="search-filter" data-f="NT" onchange="updateSearchFilters()" style="cursor:pointer" checked> 신약
            </label>
            <label style="font-size:10px;color:var(--text2);margin-right:8px;display:inline-flex;align-items:center;gap:4px;">
              <input type="checkbox" class="search-filter" data-f="notes" onchange="updateSearchFilters()" style="cursor:pointer" checked> 노트
            </label>
            <label style="font-size:10px;color:var(--text2);margin-right:8px;display:inline-flex;align-items:center;gap:4px;">
              <input type="checkbox" class="search-filter" data-f="commentary" onchange="updateSearchFilters()" style="cursor:pointer" checked> 주석
            </label>
          </div>
          <div class="sch-count" id="schCount"></div>
          <div id="schList"></div>
        </div>
      </div>

    </div>
  </div>
</div>

<!-- ══ CONTEXT MENU ════════════════════════════ -->
<div id="ctxMenu">
  <div class="citem" onclick="ctxHL()"><i class="fa fa-highlighter"></i> 형광펜 적용 (드래그 선택 후)</div>
  <div class="citem" onclick="ctxClearHL()" id="ctxClearHLItem" style="display:none"><i class="fa fa-eraser"></i> 형광펜 지우기</div>
  <div class="citem" onclick="ctxVerseMemo()"><i class="fa fa-comment-dots"></i> 주석 작성</div>
  <div class="citem" onclick="ctxNote()"><i class="fa fa-pen"></i> 새 노트 작성</div>
  <div class="citem" onclick="ctxLinkNote()"><i class="fa fa-link"></i> 노트 연결</div>
  <div class="citem" onclick="ctxDict()"><i class="fa fa-book"></i> 사전 보기</div>
  <div class="cdiv"></div>
  <div class="citem" onclick="addBookmark()"><i class="fa fa-bookmark"></i> 북마크 추가/제거</div>
  <div class="citem" onclick="ctxCopy()"><i class="fa fa-copy"></i> 구절 복사</div>
  <div class="citem" onclick="ctxCopyRef()"><i class="fa fa-quote-right"></i> 참조 형식 복사</div>
  <div class="cdiv"></div>
  <div class="citem" onclick="ctxInsertLink()"><i class="fa fa-link"></i> 노트에 구절 링크 삽입</div>
</div>

<!-- ══ MODALS ══════════════════════════════════ -->
<div class="modal-bg" id="mQuota">
  <div class="modal-box">
    <div class="modal-title"><i class="fa fa-database"></i> 저장 공간</div>
    <div id="quotaDetail"></div>
    <div class="modal-btns">
      <button class="mbtn mbtn-cancel" onclick="closeM('mQuota')">닫기</button>
      <button class="mbtn mbtn-ok" onclick="showUpgradeMsg()"><i class="fa fa-arrow-up"></i> 업그레이드</button>
    </div>
  </div>
</div>

<div class="modal-bg" id="mFolder">
  <div class="modal-box">
    <div class="modal-title"><i class="fa fa-folder-plus"></i> 새 폴더 만들기</div>
    <input type="text" class="modal-inp" id="mFolderName" placeholder="폴더 이름 (예: 로마서 연구, 매일 묵상...)">
    <div class="modal-btns">
      <button class="mbtn mbtn-cancel" onclick="closeM('mFolder')">취소</button>
      <button class="mbtn mbtn-ok" onclick="createFolder()">만들기</button>
    </div>
  </div>
</div>

<div class="modal-bg" id="mVerse">
  <div class="modal-box">
    <div class="modal-title"><i class="fa fa-bible"></i> 성경 구절 링크 삽입</div>
    <div style="display:flex;gap:6px;margin-bottom:10px">
      <select id="vlB" class="modal-inp" style="flex:1;margin:0" onchange="vlChBuild()"></select>
      <select id="vlC" class="modal-inp" style="width:80px;margin:0" onchange="vlPrev()"></select>
      <input type="number" id="vlV" class="modal-inp" style="width:68px;margin:0" placeholder="절" min="1" max="200" oninput="vlPrev()">
    </div>
    <div style="font-size:12px;color:var(--text3);margin-bottom:12px">미리보기: <span id="vlPrev" style="color:var(--gold);font-family:'JetBrains Mono',monospace"></span></div>
    <div class="modal-btns">
      <button class="mbtn mbtn-cancel" onclick="closeM('mVerse')">취소</button>
      <button class="mbtn mbtn-ok" onclick="confirmVL()">삽입</button>
    </div>
  </div>
</div>

<div class="modal-bg" id="mNoteLink">
  <div class="modal-box">
    <div class="modal-title"><i class="fa fa-link"></i> 노트 링크 삽입</div>
    <input type="text" class="modal-inp" id="nlSearch" placeholder="노트 제목 검색..." oninput="filterNoteLinks(this.value)">
    <div id="notePicker"></div>
    <div class="modal-btns">
      <button class="mbtn mbtn-cancel" onclick="closeM('mNoteLink')">취소</button>
    </div>
  </div>
</div>

<!-- Verse Tooltip -->
<div id="vtip"><div id="vtip-ref"></div><div id="vtip-txt"></div></div>
<!-- Toast -->
<div id="toast"></div>

<!-- ═══════════════════════════════════════════════
     SCRIPTS (모듈화된 JS)
═══════════════════════════════════════════════ -->

<!-- Firebase UI (전역 함수, 모듈보다 먼저) -->
<script src="js/firebase-ui.js"></script>
<script src="js/firebase-quota-ui.js"></script>

<!-- 데이터 (작은 파일, 동기 로드) -->
<script src="data/books.js"></script>

<!-- 코어 모듈 (의존성 없음, 먼저 로드) -->
<script src="js/data-loader.js"></script>
<script src="js/state.js"></script>
<script src="js/theme.js"></script>
<script src="js/storage.js"></script>
<script src="js/ui-utils.js"></script>

<!-- 비주얼 필터 -->
<script src="js/visual-filter.js"></script>

<!-- 성경 관련 -->
<script src="js/bible-renderer.js"></script>
<script src="js/bible-renderer-hl.js"></script>
<script src="js/book-nav.js"></script>
<script src="js/book-nav-actions.js"></script>
<script src="js/book-names-en.js"></script>
<script src="js/nav-picker.js"></script>
<script src="js/nav-picker-ui.js"></script>
<script src="js/nav-picker-render.js"></script>
<script src="js/nav-picker-actions.js"></script>
<script src="js/bible-tabs.js"></script>
<script src="js/bible-tabs-render.js"></script>
<script src="js/bible-view-bar.js"></script>
<script src="js/ch-picker.js"></script>
<script src="js/ch-picker-render.js"></script>
<script src="js/ch-picker-grid.js"></script>

<!-- 하이라이트 & 절 선택 -->
<script src="js/highlight.js"></script>
<script src="js/highlight-picker.js"></script>
<script src="js/highlight-apply.js"></script>
<script src="js/highlight-memo.js"></script>
<script src="js/highlight-memo-data.js"></script>
<script src="js/highlight-memo-verse.js"></script>
<script src="js/highlight-memo-parse.js"></script>
<script src="js/highlight-memo-notelink.js"></script>
<script src="js/highlight-memo-search.js"></script>
<script src="js/highlight-memo-filter.js"></script>
<script src="js/highlight-memo-tags.js"></script>
<script src="js/highlight-memo-save.js"></script>
<script src="js/verse-select.js"></script>

<!-- 주석 & 사전 -->
<script src="js/commentary-verse.js"></script>
<script src="js/commentary-chapter.js"></script>
<script src="js/commentary.js"></script>
<script src="js/data-loader-strongs.js"></script>
<script src="js/strongs-book-group.js"></script>
<script src="js/strongs-load-helpers.js"></script>
<script src="js/strongs-ui.js"></script>
<script src="js/strongs-ui-def.js"></script>
<script src="js/strongs-ui-search.js"></script>
<script src="js/bible-renderer-strongs.js"></script>
<script src="js/word-study.js"></script>
<script src="js/word-study-paginate.js"></script>
<script src="js/word-study-en.js"></script>
<script src="js/adv-search-engine.js"></script>
<script src="js/adv-search-match.js"></script>
<script src="js/adv-search-filter.js"></script>
<script src="js/adv-search-stats.js"></script>
<script src="js/adv-search-bookmap.js"></script>
<script src="js/adv-search-exec.js"></script>
<script src="js/adv-search-exec-en.js"></script>
<script src="js/adv-search-results.js"></script>
<script src="js/adv-search-views.js"></script>
<script src="js/adv-search-nav.js"></script>
<script src="js/adv-search-ui.js"></script>
<script src="js/adv-search-ui-html.js"></script>
<script src="js/adv-search-panel.js"></script>
<script src="js/adv-search-ctrl.js"></script>

<!-- 사전 (웹스터/영한/국어) -->
<script src="js/webster-api.js"></script>
<script src="js/webster-ui.js"></script>
<script src="js/webster-search.js"></script>
<script src="js/enko-api.js"></script>
<script src="js/enko-ui.js"></script>
<script src="js/enko-search.js"></script>
<script src="js/enko-translate.js"></script>
<script src="js/korean-search.js"></script>

<!-- 노트 시스템 -->
<script src="js/notes-autosave.js"></script>
<script src="js/notes-editor.js"></script>
<script src="js/notes-editor-insert.js"></script>
<script src="js/notes-editor-inline.js"></script>
<script src="js/notes-manager.js"></script>
<script src="js/notes-manager-save.js"></script>
<script src="js/notes-manager-ui.js"></script>
<script src="js/notes-folders.js"></script>
<script src="js/notes-folders-render.js"></script>
<script src="js/notes-folders-ctx.js"></script>
<script src="js/notes-folders-crud.js"></script>
<script src="js/notes-folders-new.js"></script>
<script src="js/notes-links.js"></script>
<script src="js/notes-links-notelink.js"></script>
<script src="js/notes-links-embed.js"></script>
<script src="js/notes-links-url.js"></script>
<script src="js/notes-links-youtube.js"></script>
<script src="js/notes-links-file.js"></script>
<script src="js/notes-links-verse.js"></script>
<script src="js/notes-links-vtip.js"></script>

<!-- 교차참조 & Passage Guide -->
<script src="js/xref-inline.js"></script>
<script src="js/passage-guide.js"></script>

<!-- 아이콘 레일 & 사이드패널 -->
<script src="js/icon-rail.js"></script>
<script src="js/side-notes.js"></script>
<script src="js/bookmark-panel.js"></script>
<script src="js/side-search.js"></script>

<!-- 설정 패널 -->
<script src="js/settings-panel.js"></script>
<script src="js/settings-panel-ctrl.js"></script>
<script src="js/settings-panel-apply.js"></script>
<script src="js/settings-panel-sync.js"></script>

<!-- 컨텍스트 메뉴 & 패널 -->
<script src="js/context-menu.js"></script>
<script src="js/context-menu-notelink.js"></script>
<script src="js/context-menu-versememo.js"></script>
<script src="js/context-menu-actions.js"></script>
<script src="js/context-menu-copy.js"></script>
<script src="js/panels.js"></script>
<script src="js/panel-tabs.js"></script>
<script src="js/panel-tabs-sub.js"></script>
<script src="js/panel-nav.js"></script>
<script src="js/outline.js"></script>
<script src="js/outline-note.js"></script>
<script src="js/outline-note-ui.js"></script>
<script src="js/search.js"></script>
<script src="js/search-exec.js"></script>
<script src="js/search-quick.js"></script>
<script src="js/read-mode.js"></script>

<!-- 읽기 계획 -->
<script src="js/reading-plan-data.js"></script>
<script src="js/reading-plan-gen.js"></script>
<script src="js/reading-plan.js"></script>
<script src="js/reading-plan-ui.js"></script>
<script src="js/reading-plan-render.js"></script>

<!-- 초기화 (반드시 마지막) -->
<script src="js/app-paste.js"></script>
<script src="js/app.js"></script>

</body>
</html>
