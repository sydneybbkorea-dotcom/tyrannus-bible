/* ═══════════════════════════════════════════════
   KNOWLEDGE GRAPH — D3.js force-directed visualization
═══════════════════════════════════════════════ */

/* ── Graph Overlay ── */
.kg-overlay {
  position: fixed;
  inset: 0;
  z-index: 9000;
  background: var(--bg-primary, var(--bg));
  display: flex;
  flex-direction: column;
}

/* ── Graph Header ── */
.kg-header {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 10px 16px;
  background: var(--bg-secondary, var(--bg2));
  border-bottom: 1px solid var(--border-color, var(--border));
  flex-shrink: 0;
}
.kg-title {
  font-size: 14px;
  font-weight: 700;
  color: var(--text-primary, var(--text));
  flex: 1;
}
.kg-title i { margin-right: 6px; color: var(--accent-color, var(--gold)); }
.kg-close {
  width: 32px; height: 32px;
  display: flex; align-items: center; justify-content: center;
  border-radius: var(--radius-sm, 4px);
  cursor: pointer; font-size: 14px;
  color: var(--text-muted, var(--text3));
  transition: all var(--anim-fast, 150ms);
}
.kg-close:hover { background: var(--bg-tertiary, var(--bg3)); color: var(--text-primary, var(--text)); }

/* ── Graph Body ── */
.kg-body {
  flex: 1;
  position: relative;
  overflow: hidden;
}
.kg-body svg {
  width: 100%;
  height: 100%;
}

/* ── Graph Nodes ── */
.kg-node {
  cursor: pointer;
}
.kg-node circle {
  stroke-width: 1.5;
  transition: r 0.2s, stroke-width 0.2s;
}
.kg-node:hover circle {
  stroke-width: 3;
  filter: brightness(1.2);
}
.kg-node text {
  font-size: 10px;
  fill: var(--text-primary, var(--text));
  pointer-events: none;
  text-anchor: middle;
  dominant-baseline: central;
}

/* Node type colors */
.kg-node-verse circle    { fill: #EAB308; stroke: #CA8A04; }
.kg-node-note circle     { fill: #3B82F6; stroke: #2563EB; }
.kg-node-pdf circle      { fill: #EF4444; stroke: #DC2626; }
.kg-node-strong circle   { fill: #22C55E; stroke: #16A34A; }
.kg-node-commentary circle { fill: #A855F7; stroke: #9333EA; }
.kg-node-tag circle      { fill: #F97316; stroke: #EA580C; }
.kg-node-unknown circle  { fill: #6B7280; stroke: #4B5563; }

/* Active/center node */
.kg-node-center circle {
  stroke-width: 3;
  filter: drop-shadow(0 0 8px rgba(255, 255, 255, 0.3));
}

/* ── Graph Edges ── */
.kg-edge {
  stroke: var(--text-faint, var(--text3));
  stroke-width: 1;
  opacity: 0.4;
  transition: opacity 0.2s;
}
.kg-edge:hover { opacity: 0.8; stroke-width: 2; }
.kg-edge-reference { stroke: var(--blue, #4a9ef0); }
.kg-edge-annotation { stroke: var(--red, #f05050); }
.kg-edge-cross-reference { stroke: var(--green, #30c870); }
.kg-edge-strong { stroke: var(--purple, #a06cf0); }

/* ── Filter Panel ── */
.kg-filters {
  position: absolute;
  top: 8px; right: 8px;
  background: var(--bg-surface, var(--bg3));
  border: 1px solid var(--border-color, var(--border));
  border-radius: var(--radius-md, 8px);
  padding: 10px 12px;
  box-shadow: var(--shadow-md);
  display: flex;
  flex-direction: column;
  gap: 8px;
  z-index: 10;
  max-width: 200px;
}
.kg-filter-title {
  font-size: 10px;
  font-weight: 700;
  color: var(--text-muted, var(--text3));
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

/* ── Filter Chips ── */
.kg-chip {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  padding: 4px 10px;
  border-radius: 12px;
  font-size: 11px;
  font-weight: 600;
  cursor: pointer;
  transition: all var(--anim-fast, 150ms);
  border: 1px solid transparent;
  user-select: none;
}
.kg-chip.active { opacity: 1; }
.kg-chip.inactive { opacity: 0.35; filter: grayscale(0.5); }

.kg-chip-verse   { background: rgba(234, 179, 8, 0.15); color: #EAB308; border-color: rgba(234, 179, 8, 0.3); }
.kg-chip-note    { background: rgba(59, 130, 246, 0.15); color: #3B82F6; border-color: rgba(59, 130, 246, 0.3); }
.kg-chip-pdf     { background: rgba(239, 68, 68, 0.15); color: #EF4444; border-color: rgba(239, 68, 68, 0.3); }
.kg-chip-strong  { background: rgba(34, 197, 94, 0.15); color: #22C55E; border-color: rgba(34, 197, 94, 0.3); }
.kg-chip-commentary { background: rgba(168, 85, 247, 0.15); color: #A855F7; border-color: rgba(168, 85, 247, 0.3); }

.kg-chip-dot {
  width: 8px; height: 8px;
  border-radius: 50%;
}
.kg-chip-verse .kg-chip-dot   { background: #EAB308; }
.kg-chip-note .kg-chip-dot    { background: #3B82F6; }
.kg-chip-pdf .kg-chip-dot     { background: #EF4444; }
.kg-chip-strong .kg-chip-dot  { background: #22C55E; }
.kg-chip-commentary .kg-chip-dot { background: #A855F7; }

/* ── Node Info Tooltip ── */
.kg-tooltip {
  position: absolute;
  background: var(--bg-surface, var(--bg3));
  border: 1px solid var(--border-color, var(--border));
  border-radius: var(--radius-md, 8px);
  padding: 8px 12px;
  box-shadow: var(--shadow-md);
  font-size: 12px;
  color: var(--text-primary, var(--text));
  pointer-events: none;
  z-index: 20;
  max-width: 250px;
}
.kg-tooltip-type {
  font-size: 9px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin-bottom: 4px;
}

/* ── Backlink Graph Button ── */
.bl-graph-btn {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 6px 10px;
  margin-top: 6px;
  border-radius: var(--radius-sm, 4px);
  font-size: 11px;
  font-weight: 600;
  color: var(--accent-color, var(--gold));
  cursor: pointer;
  transition: background var(--anim-fast, 150ms);
}
.bl-graph-btn:hover {
  background: var(--bg-tertiary, var(--bg3));
}
.bl-graph-btn i {
  font-size: 12px;
}

/* ── Passage Guide graph link ── */
.pg-stat-graph {
  color: var(--accent-color, var(--gold));
  font-weight: 600;
}
.pg-stat-graph:hover {
  text-decoration: underline;
}
